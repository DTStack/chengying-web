---
id: install
title: 安装部署
---

[![License](https://img.shields.io/badge/license-Apache%202-4EB1BA.svg)](https://www.apache.org/licenses/LICENSE-2.0.html)

## 添加集群
在集群下部署组件前要求用户先完成集群添加。进入"部署中心-集群管理-添加集群"选择集群类型进行集群添加。
![q1](/img/introduction/cluster.png)

### 添加主机集群
选择 “创建主机集群”，填写基础信息包括 “集群名称、集群描述、集群标签”，点击 “下一步” 进入集群主机添加和管理。

### 添加主机
主机接入，指将主机添加进集群，用于产品服务的部署。包含2种方式：账号接入、命令行接入。
1. 账号接入：通过在界面上配置用户名、密码的方式接入主机
    * 主机分组：在集群内主机较多的情况下，可对主机进行分组，当无主机分组时，可新建分组。
    * 机器IP：可输入多个IP、IP端。多个IP之间用英文逗号隔开，IP端用'-'连接。系统接入时将按照顺序接入。
    * SSH端口：一般默认填写22端口。
    * 登录方式：密钥文件或密码接入。
    * 密钥文件：选择密钥登录方式要求用户上传密钥文件。
    * 用户名、密码：接入主机的用户需要 sudo+NOPASSWD 权限。
    
2. 命令行接入：通过在服务器上执行命令的方式接入主机。
```
curl 'http://local_ip:8889/api/v1/deploy/sidecar/install/shell?TargetPath=/opt/dtstack/easymanager/easyagent&CallBack=aHR0cDovL21hdHJpeDo4ODY0L2FwaS92Mi9hZ2VudC9pbnN0YWxsL2NhbGxiYWNrP2FpZD0tMQ==&Type=hosts&ClusterId=1&Roles=' | sh
```
local_ip为部署Chengying的机器ip。

### 查看主机
主机接入后，可在主机列表中查看集群中所有的主机，以及每个主机的状态。包含主机最近心跳时间、主机创建时间、启动用户、agent状态、初始化状态。
主机安装会经过2个过程：管控安装-主机初始化，若某一步安装失败，请查看具体日志。主机安装失败时，可查看具体的失败日志。

## 集群列表
已添加的集群可在"部署中心-集群管理-集群列表"进行查看和管理。该页面展示集群的状态、资源使用、节点数等基本信息，可对集群进行详情查看、编辑及删除操作。
![q2](/img/introduction/clusterList.png)

## 部署组件
在部署组件前，我们需要先上传要部署的组件，并通过全流程的安装部署向导，让运维人员轻松完成产品的安装部署。
产品安装需经过四步：上传组件安装包—​选择集群—​选择产品包—​配置服务—​执行部署。

### 上传组件安装包
用户可在 "部署中心-组件管理-组件列表"页面进行组件安装包上传，并可对上传的组件包进行部署、删除等管理操作。
鼠标hover “上传组件安装包”，平台提供两种方式进行组件包上传——上传本地包、来自网络。
- 上传本地包：点击选择本地产品包进行上传。
- 来自网络：点击可支持输入多个产品包地址直接从网络下载至平台。

![q3](/img/introduction/clusterPackage.png)

### 选择集群
步骤一：选择部署方式及集群。
![q3](/img/introduction/chooseCluster.png)

### 选择产品包
步骤二：选择需要部署的组件包与服务。
- 选择产品包与服务：产品包选择后，会显示该产品包下各服务的名称、版本。若为置灰的服务，则是该组件依赖的服务。
- 产品包设置：设置该应用启动时的用户名，但仅以root用户接入主机时，该设置有效。
:::tip
  应用启动用户名，将初始化进产品包的各服务中， 即产品包下各服务部署时，默认以此用户名启动。同时，各服务也支持使用不同的启动用户名， 故实际部署以最终细粒度的服务启动用户名为准。
:::
- 产品包删除：未部署的产品包支持删除，已被部署过的产品包无论当前是什么状态都不支持删除。
![q4](/img/introduction/chooseProduct.png)

### 配置服务
步骤三：配置产品包下各服务在哪些主机上安装以及各服务的参数。
![q5](/img/introduction/chooseService.png)
**资源分配**

资源分配指分配服务安装的节点，包含手动分配以及系统自动分配2种方式。
- 手动分配：运维人员手动从所有主机中选择需要的主机放置右侧穿梭框中，支持批量选择；
- 自动分配：自动分配分为2个层面，全局分配与局部分配。全局分配指该产品下所有服务的主机资源系统自动分配；局部分配指部分服务可进行自动分配。是否可自动分配需根据具体的产品包来。

:::tip
在穿梭框中选择后，该选项便已保存，后续在执行部署时直接进行部署。
:::


**外部主机**

使用外部主机指该服务可能环境已有，不需要重新部署，直接引用部署该服务的主机即可。
![q6](/img/introduction/externalHost.png)

如上图，填写该服务部署的IP地址即可。

**参数配置**

参数配置包含运行配置、部署配置、依赖服务。参数配置都有默认参数，运维人员可查看、修改。

- 运行配置：服务运行时需要的配置，如数据库名称、用户名、密码等；
- 部署配置：包含配置路径、日志存储路径、健康检查脚本、健康检查间隔时间、健康检查超时时间、健康检查重试次数、监控端口等信息；
- 依赖服务：该服务依赖的其他服务，只可查看，不可更改。
参数可恢复默认值，当参数修改失误时，可点击恢复按钮，恢复默认值。

:::tip
此处的参数修改为即时保存，修改一个参数，光标移出输入框时，便进行保存，在部署时生效。
:::

### 执行部署
步骤四：资源配置完成后，可点击 “执行部署” 开始部署。
![q7](/img/introduction/deploy.png)
#### 查看部署进度
产品包中的服务将按照服务依赖顺序开始部署，若没有依赖，多个服务可同时部署。
#### 启动状态查看
查看每个服务实例的部署状态，包含安装中、安装成功、安装失败、卸载中、卸载成功、卸载失败、运行中、运行失败、健康检查失败、健康检查取消、停止中、停止成功、停止失败等状态。对于失败的状态可查看具体失败原因，及部署日志进行排错。
#### 查看全部部署日志
部署结束后，可查看该产品的全部部署日志，按照部署顺序排列。
#### 停止部署
部署过程中可终止部署进程，停止部署后可退出部署向导。

经过以上步骤，便可完成产品包的部署。部署完成后，可回到主页面，点击一级菜单"运维中心"从产品维度查看各组件、服务的运行，进入集群运维阶段。