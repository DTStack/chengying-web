"use strict";(self.webpackChunkchengying_web=self.webpackChunkchengying_web||[]).push([[133],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>k});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=p(t),m=r,k=u["".concat(s,".").concat(m)]||u[m]||d[m]||l;return t?a.createElement(k,o(o({ref:n},c),{},{components:t})):a.createElement(k,o({ref:n},c))}));function k(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,o=new Array(l);o[0]=m;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i[u]="string"==typeof e?e:r,o[1]=i;for(var p=2;p<l;p++)o[p]=t[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},4181:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>p});var a=t(7462),r=(t(7294),t(3905));const l={title:"\u4ea7\u54c1\u5305\u5236\u4f5c"},o=void 0,i={unversionedId:"chengyingDocs/introduction/schema",id:"chengyingDocs/introduction/schema",title:"\u4ea7\u54c1\u5305\u5236\u4f5c",description:"License",source:"@site/i18n/zh-cn/docusaurus-plugin-content-docs/current/chengyingDocs/introduction/schema.md",sourceDirName:"chengyingDocs/introduction",slug:"/chengyingDocs/introduction/schema",permalink:"/chengying-web/docs/chengyingDocs/introduction/schema",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/chengyingDocs/introduction/schema.md",tags:[],version:"current",frontMatter:{title:"\u4ea7\u54c1\u5305\u5236\u4f5c"},sidebar:"docs",previous:{title:"\u76d1\u63a7\u544a\u8b66",permalink:"/chengying-web/docs/chengyingDocs/introduction/monitor"},next:{title:"\u666e\u901a\u5347\u7ea7",permalink:"/chengying-web/docs/chengyingDocs/introduction/commonUpgrade"}},s={},p=[{value:"\u9876\u5c42\u5b57\u6bb5",id:"\u9876\u5c42\u5b57\u6bb5",level:2},{value:"\u670d\u52a1\u5b57\u6bb5",id:"\u670d\u52a1\u5b57\u6bb5",level:2},{value:"\u670d\u52a1\u5185\u5173\u952e\u5b57\u6bb5",id:"\u670d\u52a1\u5185\u5173\u952e\u5b57\u6bb5",level:2},{value:"\u53d8\u91cf\u5f15\u7528",id:"\u53d8\u91cf\u5f15\u7528",level:2},{value:"\u670d\u52a1\u914d\u7f6e\u6587\u4ef6",id:"\u670d\u52a1\u914d\u7f6e\u6587\u4ef6",level:2},{value:"\u865a\u62df\u670d\u52a1",id:"\u865a\u62df\u670d\u52a1",level:2},{value:"\u542f\u52a8\u987a\u5e8f",id:"\u542f\u52a8\u987a\u5e8f",level:2},{value:"\u670d\u52a1\u5b88\u62a4",id:"\u670d\u52a1\u5b88\u62a4",level:2},{value:"\u670d\u52a1\u5b89\u88c5\u8def\u5f84",id:"\u670d\u52a1\u5b89\u88c5\u8def\u5f84",level:2},{value:"\u670d\u52a1\u7ee7\u627f",id:"\u670d\u52a1\u7ee7\u627f",level:2},{value:"\u5de5\u4f5c\u76ee\u5f55",id:"\u5de5\u4f5c\u76ee\u5f55",level:2},{value:"\u547d\u4ee4\u884c\u6587\u4ef6\u8def\u5f84",id:"\u547d\u4ee4\u884c\u6587\u4ef6\u8def\u5f84",level:2},{value:"\u76d1\u63a7\u7cfb\u7edf",id:"\u76d1\u63a7\u7cfb\u7edf",level:2},{value:"\u4ea7\u54c1\u5305\u6253\u5305\u65b9\u6cd5",id:"\u4ea7\u54c1\u5305\u6253\u5305\u65b9\u6cd5",level:2},{value:"\u5236\u4f5c\u4ea7\u54c1\u5305\u524d\u601d\u8003",id:"\u5236\u4f5c\u4ea7\u54c1\u5305\u524d\u601d\u8003",level:3},{value:"\u793a\u4f8b\u601d\u8003",id:"\u793a\u4f8b\u601d\u8003",level:4},{value:"\u5236\u4f5c\u4ea7\u54c1\u5305\u524d\u51c6\u5907",id:"\u5236\u4f5c\u4ea7\u54c1\u5305\u524d\u51c6\u5907",level:3},{value:"\u793a\u4f8b\u51c6\u5907",id:"\u793a\u4f8b\u51c6\u5907",level:4},{value:"\u793a\u4f8bschema\u914d\u7f6e",id:"\u793a\u4f8bschema\u914d\u7f6e",level:3},{value:"mero\u6253\u5305",id:"mero\u6253\u5305",level:2}],c={toc:p};function u(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.apache.org/licenses/LICENSE-2.0.html"},(0,r.kt)("img",{parentName:"a",src:"https://img.shields.io/badge/license-Apache%202-4EB1BA.svg",alt:"License"}))),(0,r.kt)("h1",{id:"\u4ea7\u54c1\u5305\u5236\u4f5c"},"\u4ea7\u54c1\u5305\u5236\u4f5c"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u9996\u5148\uff0c\u5728\u5236\u4f5c\u4ea7\u54c1\u5305\u4e4b\u524d\uff0c\u5148\u770b\u770b\u6211\u4eec\u8981\u51c6\u5907\u54ea\u4e9b\u5185\u5bb9\u3002")),(0,r.kt)("p",null,"1.\u5fc5\u987b\u5305\u542bschema\u6587\u4ef6\uff08\u540d\u79f0\u5fc5\u987b\u662f",(0,r.kt)("inlineCode",{parentName:"p"},"schema.yml"),"\uff09"),(0,r.kt)("p",null,"2.\u5404\u4e2a\u670d\u52a1\u76ee\u5f55\uff08\u76ee\u5f55\u540d\u4e3a\u670d\u52a1\u540d\uff09"),(0,r.kt)("p",null,"3.",(0,r.kt)("a",{parentName:"p",href:"https://dtstack-download.oss-cn-hangzhou.aliyuncs.com/chengying/mero"},"mero"),"\u53ef\u6267\u884c\u6587\u4ef6"),(0,r.kt)("h1",{id:"schema\u914d\u7f6e\u4ecb\u7ecd"},"schema\u914d\u7f6e\u4ecb\u7ecd"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"schema\u6587\u4ef6\u662f\u4e00\u4e2a\u6807\u51c6\u7684yaml\u6587\u4ef6")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"parent_product_name: DTinsight\nproduct_name: dtstack easy-stack\nproduct_name_display: dtstack easy-stack\uff08product_name\u7684\u663e\u793a\u540d\uff0c\u53ef\u9009\uff09\nproduct_version: 2.1-xinwang\nservice:\n  dtlog:\n    service_display: dtlog\uff08service\u7684\u663e\u793a\u540d\uff0c\u53ef\u9009\uff09\n    version: 1.8.1\n    orchestration:\n      affinity:\n        - web\n      anti_affinity:\n        - mysql\n    instance:\n      pseudo: true #\u4f2a\u670d\u52a1\n      ha_role_cmd: echo master #HA command\n      #install path /opt/dtstack/dtstack easy-stack/dtlog\n      cmd: bin/dtlog --port ${SLB.dtlog_front_port} --config ${config_path} --ca ${es.ca_file} --uic ${dtuic.jjww} #\u670d\u52a1tar\u5305\u5185\u8def\u5f84\n      config_paths:\n        - ${config_path}\n      environment:\n        MYSQL_ADDRESS: ${mysql.esip}:${es.bizdb}\n        ES_ADDR: ${@es} #es service first ip\n      healthcheck:\n        shell: curl http://${dtlog_ip_port}/xxx/healthcheck\n        #period: 30s #default 60s\n        start_period: 10s #default 10s\n        timeout: 10s #default 10s\n        retries: 1 #default 1\n      max_replica: 3\n      start_after_install: false\n      post_deploy: chown 0644 dtlog && zkcreate node xxx --ip ${@es}\n      post_undeploy: rm -rf /var/data/dtlog\n      logs:\n      - log/abc.log\n      - /var/log/dtlog/*.log\n    group: default\n    depends_on:\n    - es\n    - dtuic\n    config:\n      log_port: 8888\n      config_path: dtlog.ini\n      dtlog_ip_port: ${@dtlog}:8080 #self service's node ip\n      es_ips: ${@es} #es service ip lists\n      self_ip: ${@dtlog}\n      \n      \n      \n      \n  es:\n    version: 1.2\n    instance:\n      use_cloud: true  # same as instance == null\n      cmd: start.sh\n    config:\n      ca_file:\n        type: filepath\n        desc: CA-File for EasyLog\n        default: etc/es.ca.key\n      bizdb: guyan${mysql.dsn}\n      \n      \n      \n  mysql:\n    version: 5.7\n    instance:\n      cmd: start.sh\n      max_replica: 1\n      prometheus_port: ${prometheus_port}\n      update_recreate: true\n    config:\n      username:\n        type: string\n        desc: Database Username for EasyLog\n        default: root\n      password:\n        type: string\n        desc: Database Password for EasyLog\n        default: dtstack\n      dsn: /dbname?encode=utf8\n      prometheus_port: 9104\n      esip: ${@es}\n      \n      \n      \n      \n  SLB:\n    version: 8.7\n    #no instance, usually for cloud or other service/product\n    config:\n      dtlog_front_port:\n        type: port\n        desc: Uic port for EasyLog\n        default: ${dtlog.log_port}\n      dtlog_back_port: 8879\n  dtuic@other_product.uic:\n    #other-product uic's instance field not inherit\n    version: 1.0\n    #no instance, usually for cloud or other service/product\n    depends_on:\n    - es\n    - SLB\n    config:\n      username:\n        type: string\n        desc: Username for UIC\n        default: root\n      password:\n        type: string\n        desc: Password for UIC\n        default: dtstack\n")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"\u914d\u7f6e\u9879\u6620\u5c04schema\u53d8\u91cf")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'es-server: http://{{.Join .es_ips ","}}/aaa\narg: -c {{.config_path}} -self {{.dtlog_ip_port}} -host {{.Hostname .es_ips}}\nnode-count: {{.NodeCount .self_ip}}\nnode-index: {{.NodeIndex .self_ip}}\nnode-id: {{.NodeID .self_ip}} ##\u5206\u914d\u540e\u4e0d\u53d8\nbroker-id: {{.LastSegIP .self_ip}}  ##IP\u6700\u540e\u4e00\u6bb5\u4f5c\u4e3abroker-id\nadd-one: {{.AddOne 100}}\nJoinHost: http://{{.JoinHost .self_ip ","}}\nJoinHost_: http://{{.JoinHost "self_ip" ","}} ##\u4f7f\u7528\u5b57\u7b26\u4e32\uff0c\u4e0d\u63a8\u8350\nJoinxHost: http://{{.JoinxHost .self_ip ","}}\nHostname: {{.Hostname .self_ip}}\nIPList: {{range $v := .IPList .self_ip}}{{$v}},{{end}}\nHostList: {{range $v := .HostList .self_ip}}{{$v}},{{end}}\nHostList_: {{range $v := .HostList "self_ip"}}{{$v}},{{end}} ##\u4f7f\u7528\u5b57\u7b26\u4e32\uff0c\u4e0d\u63a8\u8350\nGetIpByNodeID: {{.GetIpByNodeID .NodeID .self_ip}}\n')),(0,r.kt)("h1",{id:"\u914d\u7f6e\u4ecb\u7ecd"},"\u914d\u7f6e\u4ecb\u7ecd"),(0,r.kt)("h2",{id:"\u9876\u5c42\u5b57\u6bb5"},"\u9876\u5c42\u5b57\u6bb5"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"parent_product_name: \u4ea7\u54c1\u540d\u79f0"),(0,r.kt)("li",{parentName:"ul"},"product_name\uff1a\u4ea7\u54c1\u540d\u79f0\uff0c\u4e0d\u80fd\u91cd\u590d\uff0c\u4e0d\u80fd\u4fee\u6539","[\u5fc5\u586b]"),(0,r.kt)("li",{parentName:"ul"},"product_name_display\uff1a\u4ea7\u54c1\u663e\u793a\u540d\u79f0 ","[\u9009\u586b]"),(0,r.kt)("li",{parentName:"ul"},"product_version: \u4ea7\u54c1\u7248\u672c\u53f7\uff0c\u5bf9\u5916\u552f\u4e00\u53ef\u89c1\u7248\u672c\u53f7\uff08\u5347\u7ea7/\u56de\u6eda\uff09","[\u5fc5\u586b]"),(0,r.kt)("li",{parentName:"ul"},"service: \u670d\u52a1\u5b57\u5178\u5217\u8868\uff0c\u5bf9\u5e94\u670d\u52a1\u5305xxx.zip","[\u975e\u7a7a]")),(0,r.kt)("h2",{id:"\u670d\u52a1\u5b57\u6bb5"},"\u670d\u52a1\u5b57\u6bb5"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"mailto:xxx@other_product.yyy"},"xxx@other_product.yyy"),"\uff1a"),(0,r.kt)("p",null,"\u200b        xxx\u662f\u672c\u4ea7\u54c1\u5185\u7684\u552f\u4e00\u670d\u52a1\u540d,",(0,r.kt)("inlineCode",{parentName:"p"},"@"),"\u8868\u793a\u7ee7\u627f\u4e8e\uff0cother-product\u8868\u793a\u5176\u5b83\u4ea7\u54c1\u540d\u79f0\uff0cyyy\u8868\u793a\u670d\u52a1\u540d\u79f0 ",(0,r.kt)("a",{parentName:"p",href:"mailto:xxx@other_product.yyy"},"xxx@other_product.yyy"),"@xxxx\uff1a \u7ee7\u627f\u670d\u52a1\u6269\u5c55\uff0cxxxx\u4e3a\u7ee7\u627f\u670d\u52a1\u5c5e\u6027\uff0c\u5982xxxx=option\u8868\u793a\u975e\u90e8\u7f72\u4f9d\u8d56\u5fc5\u987b\uff0c\u4e3a\u53ef\u9009\u7ee7\u627f\u670d\u52a1 \u53ef\u9009\u7ee7\u627f\u670d\u52a1\u7684\u670d\u52a1IP\u7f3a\u7701\u4e3a","[127.0.0.1]","."),(0,r.kt)("h2",{id:"\u670d\u52a1\u5185\u5173\u952e\u5b57\u6bb5"},"\u670d\u52a1\u5185\u5173\u952e\u5b57\u6bb5"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"service_display\uff1a\u670d\u52a1\u7684\u663e\u793a\u540d ","[\u9009\u586b]"),(0,r.kt)("li",{parentName:"ul"},"version\uff1a\u670d\u52a1\u7248\u672c\u53f7\uff08\u5224\u65ad\u662f\u5426\u9700\u8981\u5347\u7ea7/\u56de\u6eda\uff09","[\u5fc5\u586b]"),(0,r.kt)("li",{parentName:"ul"},"depends_on\uff1a\u4f9d\u8d56\u670d\u52a1\u5217\u8868 ","[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"relatives: \u90e8\u7f72\u8840\u7f18\uff0c\u9700\u8981\u90e8\u7f72\u5728\u76f8\u540c\u7684\u8282\u70b9\u4e0a ","[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"instance\uff1a\u5b9e\u4f8b\u6570\u7ec4\uff08\u4ece\u4e0a\u5230\u4e0b\u987a\u5e8f\u6267\u884c\uff09\uff0c\u6ca1\u6709\u8868\u793a",(0,r.kt)("inlineCode",{parentName:"li"},"\u865a\u62df\u670d\u52a1"),"\uff0c\u53ea\u63d0\u4f9b\u914d\u7f6e\u4fe1\u606f\u7ed9\u5176\u5b83\u670d\u52a1\uff0c\u5982RDS\uff0cELB eg. ","[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"instance.empty_car\uff1a\u7a7a\u8f66\u6a21\u5f0f|\u7a7a\u5305\u6a21\u5f0f\uff0c\u8868\u793a\u4ec5\u90e8\u7f72\u5b9e\u4f8b\u7ba1\u63a7\u903b\u8f91\uff0c\u4e0d\u4ea7\u751f\u5b9e\u9645\u7684\u6587\u4ef6\u90e8\u7f72\uff0c\u53ef\u7528\u4e8e\u73b0\u6709\u7cfb\u7edf\u88abEM\u63a5\u7ba1","[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"instance.install_path\uff1a\u6307\u5b9a\u5b9e\u4f8b\u7684\u5b89\u88c5\u8def\u5f84\uff0c\u7f3a\u7701\u65f6\u4f7f\u7528\u9ed8\u8ba4\u5b89\u88c5\u8def\u5f84","[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"instance.use_cloud\uff1a\u662f\u5426\u4f7f\u7528\u4e91\u4e0a\u8d44\u6e90\uff0c\u8ddf",(0,r.kt)("inlineCode",{parentName:"li"},"\u865a\u62df\u670d\u52a1"),"\u610f\u4e49\u76f8\u540c","[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"instance.run_user\uff1a\u6307\u5b9a\u5b9e\u4f8b\u542f\u52a8\u7528\u6237\uff0c\u6ca1\u6709\u8868\u793a\u8ddf\u7236\u8fdb\u7a0b\u4e00\u81f4 ","[\u9009\u586b]"),(0,r.kt)("li",{parentName:"ul"},"instance.data_dir\uff1a\u6570\u636e\u76ee\u5f55\u914d\u7f6e\uff0c\u914d\u7f6erun_user\u65f6\u4f1a\u6309\u7167run_user\u505a\u76ee\u5f55chown run_user:run_user","[\u9009\u586b]"),(0,r.kt)("li",{parentName:"ul"},"instance.cmd\uff1a\u5b9e\u4f8b\u542f\u52a8\u547d\u4ee4\u884c,\u5fc5\u987bhang\u4f4f\uff08\u7a7a\u683c\u95f4\u9694\u53c2\u6570\uff0c\u975eshell\uff0c\u5ffd\u7565std/stderr\u8f93\u51fa\uff09 ","[\u5fc5\u586b]"),(0,r.kt)("li",{parentName:"ul"},"instance.home_page\uff1a\u5b9e\u4f8bhome\u9875\u9762 ","[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"instance.ha_role_cmd\uff1a\u5b9e\u4f8bHA\u89d2\u8272\u63a2\u6d4b\u547d\u4ee4 ","[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"instance.pseudo\uff1a\u662f\u5426\u662f\u4f2a\u670d\u52a1\u5b9e\u4f8b\uff0c\u9ed8\u8ba4false ","[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"instance.max_replica\uff1a\u6700\u5927\u5b9e\u4f8b/\u526f\u672c\u6570\u91cf ","[\u53ef\u9009]","  \u81ea\u52a8\u90e8\u7f72\u65f6\u4f5c\u4e3a\u8be5\u670d\u52a1\u7684\u526f\u672c\u6570"),(0,r.kt)("li",{parentName:"ul"},"instance.start_after_install\uff1a\u5f53\u6240\u6709\u8282\u70b9\u5b89\u88c5\u5b8c\u6210\u540e\u518d\u542f\u52a8","[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"instance.update_recreate\uff1a\u5148\u5220\u9664\u8001\u5b9e\u4f8b\uff0c\u518d\u542f\u52a8\u65b0\u5b9e\u4f8b","[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"instance.config_path\uff1a\u914d\u7f6e\u6587\u4ef6\u8def\u5f84","[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"instance.environment\uff1a\u73af\u5883\u53d8\u91cf\u5217\u8868 ","[\u5fc5\u586b]"),(0,r.kt)("li",{parentName:"ul"},"instance.post_deploy\uff1a\u90e8\u7f72\u5b8c\u6210\u540e\u8fd0\u884c\u547d\u4ee4","[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"instance.post_upgrade\uff1a\u90e8\u7f72\u5b8c\u6210\u540e\u6267\u884c\u7279\u5b9a\u547d\u4ee4\uff0c\u5982\u5347\u7ea7\u65f6\u589e\u91cfsql\uff0c4.1.3\u5f15\u5165","[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"instance.post_undeploy\uff1a\u5378\u8f7d\u90e8\u7f72\u5b8c\u6210\u540e\u8fd0\u884c\u547d\u4ee4","[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"instance.prometheus_port\uff1aprometheus\u76d1\u542c\u7aef\u53e3\uff08\u5982\u679c\u6709exporter\uff0c\u5fc5\u987b\u5305\u542b\u5728\u4ea7\u54c1\u5305\u4e2d\u4e14\u5728cmd\u811a\u672c\u4e2d\u542f\u52a8\uff09","[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"instance.logs: \u65e5\u5fd7\u6587\u4ef6\uff08\u652f\u6301*\u53f7\u5339\u914d\uff09","[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"instance.healthcheck\uff1a\u5065\u5eb7\u68c0\u67e5 ","[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"instance.healthcheck.shell\uff1areturn code=0\u8868\u793a\u6210\u529f","[\u5fc5\u586b]"),(0,r.kt)("li",{parentName:"ul"},'instance.healthcheck.period\uff1a\u68c0\u67e5\u5468\u671f\uff08>=1s\uff09\uff0c\u5982"300s", "5m", "1.5h"',"[\u53ef\u9009\uff0c\u9ed8\u8ba460s]"),(0,r.kt)("li",{parentName:"ul"},'instance.healthcheck.start_period\uff1a\u5f00\u59cb\u68c0\u67e5\u65f6\u95f4\uff0c\u5982"10s"',"[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},'instance.healthcheck.timeout\uff1a\u8d85\u65f6\u65f6\u95f4\uff0c\u5982"10s"',"[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"instance.healthcheck.retries\uff1a\u91cd\u8bd5\u6b21\u6570\uff0c\u5982\u679c\u90fd\u5931\u8d25\uff0c\u624d\u8ba4\u4e3a\u5065\u5eb7\u68c0\u67e5\u5931\u8d25","[\u53ef\u9009\uff0c\u9ed8\u8ba41]"),(0,r.kt)("li",{parentName:"ul"},"group: \u7ec4\u540d\u79f0\uff0c\u9ed8\u8ba4default","[\u53ef\u9009]"),(0,r.kt)("li",{parentName:"ul"},"config: \u53ef\u914d\u7f6e\u5b57\u6bb5\u5757\uff0c\u7528\u6765\u88ab\u672c\u670d\u52a1\u914d\u7f6e\u6587\u4ef6\u6216\u6240\u6709\u670d\u52a1instance,config\u5b57\u6bb5\u5f15\u7528"),(0,r.kt)("li",{parentName:"ul"},"orchestration.affinity\uff1a\u6570\u7ec4   \u81ea\u52a8\u7f16\u6392\u89d2\u8272\u4eb2\u548c\u6027  ","[\u53ef\u9009]","  \u4f46\u662f\u6ca1\u6709\u8be5\u5b57\u6bb5\u7684\u8bdd\uff0c\u8be5\u670d\u52a1\u5c06\u65e0\u6cd5\u53c2\u4e0e\u81ea\u52a8\u7f16\u6392"),(0,r.kt)("li",{parentName:"ul"},"orchestration.anti_affinity\uff1a\u6570\u7ec4   \u81ea\u52a8\u7f16\u6392\u89d2\u8272\u53cd\u4eb2\u548c\u6027  ","[\u53ef\u9009]")),(0,r.kt)("h2",{id:"\u53d8\u91cf\u5f15\u7528"},"\u53d8\u91cf\u5f15\u7528"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"${[service.]field}"),"\uff1a\u5f15\u7528service\u670d\u52a1config\u5757\u4e2d\u7684\u53d8\u91cffield\u3002service\u53ef\u4ee5\u7701\u7565\uff0c\u8868\u793a\u5f15\u7528\u672c\u670d\u52a1\u5757\u5185\u7684\u53d8\u91cf"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"${@service[.instance-name]}"),"\uff1a\u5f15\u7528service\u670d\u52a1\u4e2dinstance-name\u5b9e\u4f8bip\u5217\u8868\u3002instance-name\u53ef\u4ee5\u7701\u7565\uff0c\u8868\u793a\u6240\u6709\u5b9e\u4f8bIP\u5217\u8868")),(0,r.kt)("h2",{id:"\u670d\u52a1\u914d\u7f6e\u6587\u4ef6"},"\u670d\u52a1\u914d\u7f6e\u6587\u4ef6"),(0,r.kt)("p",null,"\u7528golang\u6a21\u677f\u5f15\u7528\u672c\u670d\u52a1\u5185\u7684\u914d\u7f6e\u5b57\u6bb5\uff0c\u8be6\u89c1",(0,r.kt)("a",{parentName:"p",href:"https://golang.org/pkg/text/template/"},"go template")," \u5185\u7f6e\u51fd\u6570Join\uff0cJoinHost\uff0cJoinx\uff0cJoinxHost\uff0cNodeCount\uff0cNodeIndex\uff0cNodeID\uff0cLastSegIP\uff0cAddOne\uff0c Hostname\uff0cIPList\uff0cHostList, GetIpByNodeID\uff0cGetHostByNodeID"),(0,r.kt)("h2",{id:"\u865a\u62df\u670d\u52a1"},"\u865a\u62df\u670d\u52a1"),(0,r.kt)("p",null,"instance\u5757\u4e0d\u914d\u7f6e\u6216instance.use_cloud\u4e3atrue"),(0,r.kt)("h2",{id:"\u542f\u52a8\u987a\u5e8f"},"\u542f\u52a8\u987a\u5e8f"),(0,r.kt)("p",null,"\u6839\u636e\u670d\u52a1depends_on\u786e\u5b9a\u542f\u52a8\u987a\u5e8f\uff0c\u6839\u636e\u5065\u5eb7\u68c0\u67e5\u7ed3\u679c\u9010\u4e2a\u542f\u52a8\u6240\u6709\u670d\u52a1\u3002\u670d\u52a1\u5185\u5b9e\u4f8b\u4ece\u4e0a\u5230\u4e0b\u542f\u52a8\u3002"),(0,r.kt)("h2",{id:"\u670d\u52a1\u5b88\u62a4"},"\u670d\u52a1\u5b88\u62a4"),(0,r.kt)("p",null,"\u670d\u52a1\u8fdb\u7a0b\u9000\u51fa\uff0c\u4f1a\u88ab\u518d\u6b21\u62c9\u8d77\uff081\u5206\u949f\u51853\u6b21\u673a\u4f1a\uff09"),(0,r.kt)("h2",{id:"\u670d\u52a1\u5b89\u88c5\u8def\u5f84"},"\u670d\u52a1\u5b89\u88c5\u8def\u5f84"),(0,r.kt)("p",null,"/opt/dtstack/product_name/service_name"),(0,r.kt)("h2",{id:"\u670d\u52a1\u7ee7\u627f"},"\u670d\u52a1\u7ee7\u627f"),(0,r.kt)("p",null,"IP\u5730\u5740\u7ee7\u627f\uff1a\u5982\u679c\u662f\u865a\u62df\u670d\u52a1\uff0cIP\u5730\u5740\u7ee7\u627f\u5230\u672c\u670d\u52a1 version\u7ee7\u627f\uff1a\u5982\u679c\u662f\u865a\u62df\u670d\u52a1\u4e14version\u672a\u8bbe\u7f6e\uff0cversion\u7ee7\u627f\u5230\u672c\u670d\u52a1 config\u5757\u7ee7\u627f\uff1a\u5b57\u6bb5\u53d8\u91cf\u5b9e\u9645\u503c\u7ee7\u627f\u5230\u672c\u670d\u52a1\uff0c\u7ee7\u627f\u5b57\u6bb5\u4f1a\u8986\u76d6\u672c\u670d\u52a1\u5b57\u6bb5 \u53ef\u9009\u670d\u52a1\u7ee7\u627f\uff1a\u53ef\u9009\u670d\u52a1\u7ee7\u627f\u4ec5\u63d0\u4f9b\u7f3a\u7701\u7684IP\u5730\u5740"),(0,r.kt)("h2",{id:"\u5de5\u4f5c\u76ee\u5f55"},"\u5de5\u4f5c\u76ee\u5f55"),(0,r.kt)("p",null,"\u670d\u52a1\u5b89\u88c5\u8def\u5f84"),(0,r.kt)("h2",{id:"\u547d\u4ee4\u884c\u6587\u4ef6\u8def\u5f84"},"\u547d\u4ee4\u884c\u6587\u4ef6\u8def\u5f84"),(0,r.kt)("p",null,"\u76f8\u5bf9\u4e8e\u670d\u52a1tar\u5305"),(0,r.kt)("h2",{id:"\u76d1\u63a7\u7cfb\u7edf"},"\u76d1\u63a7\u7cfb\u7edf"),(0,r.kt)("p",null,"EasyManager\u670d\u52a1\u7aef\u9ed8\u8ba4\u88c5\u6709prometheus\u76d1\u63a7\u7cfb\u7edf+grafana"),(0,r.kt)("h2",{id:"\u4ea7\u54c1\u5305\u6253\u5305\u65b9\u6cd5"},"\u4ea7\u54c1\u5305\u6253\u5305\u65b9\u6cd5"),(0,r.kt)("p",null,"mero pkg-dir ","[old-pkg]"," pkg-dir\u662f\u4ea7\u54c1\u5305\u76ee\u5f55\uff1a"),(0,r.kt)("p",null,"\u5fc5\u987b\u5305\u542bschema\u6587\u4ef6\uff08\u540d\u79f0\u5fc5\u987b\u662f",(0,r.kt)("inlineCode",{parentName:"p"},"schema.yml"),"\uff09"),(0,r.kt)("p",null,"\u5404\u4e2a\u670d\u52a1\u76ee\u5f55\uff08\u76ee\u5f55\u540d\u4e3a\u670d\u52a1\u540d\uff09 old-pkg\u662f\u8001\u7684\u4ea7\u54c1\u5b8c\u6574\u5305"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'mero pkg-dir\nProduct package create success: "product_name_product_version.tar"\n')),(0,r.kt)("h1",{id:"jvm\u8fdb\u7a0b\u4ea7\u54c1\u5305\u7684\u5236\u4f5c"},"Jvm\u8fdb\u7a0b\u4ea7\u54c1\u5305\u7684\u5236\u4f5c"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u5728\u5236\u4f5c\u4ea7\u54c1\u5305\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u56de\u987e\u4e00\u4e0b\u4e00\u4e2ajar\u7684\u542f\u505c\u7ef4\u62a4\u65b9\u5f0f\u3002")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u542f\u52a8")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"java -jar jarFileName.jar\u6216\u8005\u4f7f\u7528nohup\u8fdb\u884c\u540e\u53f0\u542f\u52a8")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u7ef4\u62a4")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u53ea\u80fd\u901a\u8fc7\u67e5\u770b\u65e5\u5fd7\u8fdb\u884c\u5206\u6790\uff0c\u6216\u501f\u52a9\u7b2c\u4e09\u65b9\u5de5\u5177\u3002")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u5bf9\u4e8e\u4f20\u7edf\u6a21\u5f0f\u4e0b\u5b58\u5728\u7684\u95ee\u9898")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u624b\u52a8\u542f\u505c"),(0,r.kt)("li",{parentName:"ul"},"\u8fdb\u7a0b\u5065\u5eb7\u65e0\u6cd5\u5f97\u5230\u4fdd\u969c"),(0,r.kt)("li",{parentName:"ul"},"\u65e0\u7248\u672c\u8bb0\u5f55"),(0,r.kt)("li",{parentName:"ul"},"\u7b49\u7b49")),(0,r.kt)("h3",{id:"\u5236\u4f5c\u4ea7\u54c1\u5305\u524d\u601d\u8003"},"\u5236\u4f5c\u4ea7\u54c1\u5305\u524d\u601d\u8003"),(0,r.kt)("p",null,"1.\u8fd9\u4e2a\u5305\u9700\u8981\u6709\u51e0\u4e2a\u670d\u52a1"),(0,r.kt)("p",null,"2.\u6709\u54ea\u4e9b\u662f\u4f2a\u670d\u52a1"),(0,r.kt)("p",null,"3.\u6bcf\u4e2a\u670d\u52a1\u7684\u542f\u52a8\u662f\u5426\u6709\u5f3a\u4f9d\u8d56"),(0,r.kt)("p",null,"4.\u6709\u54ea\u4e9b\u662f\u9700\u8981\u521d\u59cb\u5316"),(0,r.kt)("h4",{id:"\u793a\u4f8b\u601d\u8003"},"\u793a\u4f8b\u601d\u8003"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u90e8\u7f72\u597d\u4e86Jvm\u6240\u4f9d\u8d56\u7684\u4e00\u4e9b\u57fa\u7840\u670d\u52a1\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u542f\u52a8\u8fd9\u4e2aJar\u3002")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"\u6211\u4eec\u9700\u8981\u90e8\u7f72\u542f\u52a8\u4e00\u4e2aJvm\u8fdb\u7a0b\uff0c\u662f\u4e00\u4e2a\u6709\u72b6\u6001\u7684\u8fdb\u7a0b\uff0c\u6240\u4ee5\uff0c\u4ed6\u4e0d\u662f\u4e00\u4e2a\u4f2a\u670d\u52a1\u3002")),(0,r.kt)("h3",{id:"\u5236\u4f5c\u4ea7\u54c1\u5305\u524d\u51c6\u5907"},"\u5236\u4f5c\u4ea7\u54c1\u5305\u524d\u51c6\u5907"),(0,r.kt)("p",null,"1.\u9700\u8981\u51c6\u5907\u597d\u6bcf\u4e2a\u670d\u52a1\u7684\u521d\u59cb\u5316\u811a\u672c(\u5982\u679c\u9700\u8981)"),(0,r.kt)("p",null,"2.\u9700\u8981\u51c6\u5907\u597d\u6bcf\u4e2a\u670d\u52a1\u7684\u542f\u52a8\u811a\u672c(\u4f2a\u670d\u52a1\u4e0d\u9700\u8981)"),(0,r.kt)("p",null,"3.\u9700\u8981\u51c6\u5907\u597d\u6bcf\u4e2a\u670d\u52a1\u7684\u5065\u5eb7\u68c0\u67e5\u811a\u672c(\u4f2a\u670d\u52a1\u4e0d\u9700\u8981)"),(0,r.kt)("h4",{id:"\u793a\u4f8b\u51c6\u5907"},"\u793a\u4f8b\u51c6\u5907"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u521d\u59cb\u5316\u811a\u672c")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"#!/bin/bash\n\nmkdir -p {logs,run}\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u542f\u52a8\u811a\u672c")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"#!/bin/bash\n\nsource /etc/profile\n\nexec $JAVA_HOME/bin/java -jar test.jar\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u5065\u5eb7\u68c0\u67e5\u811a\u672c")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'#!/bin/bash\n\n#usage ./health.sh ip port1 port2 port2\n#parameter 1 is host\n#parameters after 1 are list of ports to check\n#all ports are ok echo 1, else echo 0 \n\n\nif [ $# -lt 2 ] ; then\n  echo "USAGE: $0 host [ports]" \n  exit\nfi\n \naddress=$1\nret=0\nshift\ni=$@\n\n\nfor i in "$@"; do\n  if command -v nc >/dev/null 2>&1; then\n # echo "exists nc"\n   #  echo  $address $i\n     nc -w 10  $address $i  < /dev/null >/dev/null 2>&1 \n     \n   #  echo status ======= $?\n     if [ $? -eq 0 ] ; then\n        ret=$(( $ret + 0 ))\n     else\n        ret=$(( $ret + 1 ))\n     fi\n  else\n    ret=2\n  fi\ndone\n\n\nexit $ret\n\n')),(0,r.kt)("h3",{id:"\u793a\u4f8bschema\u914d\u7f6e"},"\u793a\u4f8bschema\u914d\u7f6e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'parent_product_name: DTinsight\nproduct_name: Test_pkg\nproduct_version: v1.0.1\n \nservice:\n\n  Back:\n    version: v1.0.1\n    instance:\n      cmd: ./bin/base.sh              ##\u670d\u52a1\u7684\u542f\u52a8\u811a\u672c\n      post_deploy: ./bin/post_deploy.sh      ##\u670d\u52a1\u5728\u542f\u52a8\u524d\u7684\u521d\u59cb\u5316\u64cd\u4f5c\n      environment:             ##\u73af\u5883\u53d8\u91cf\u5bfc\u5165\uff0c\u53ef\u4ee5\u5728\u811a\u672c\u91cc\u76f4\u63a5\u5f15\u7528\n        JAVA_OPTS: ${java_opts}      \n      config_paths:            ##\u670d\u52a1\u7684\u914d\u7f6e\u6587\u4ef6\u6240\u5728\u76ee\u5f55\n      - conf/application.properties\n      healthcheck:\n        shell: ./bin/health.sh ${@Back} 8090     ##\u5065\u5eb7\u68c0\u67e5\u811a\u672c\u914d\u7f6e\n        period: 20s              ##\u5065\u5eb7\u68c0\u67e5\u7684\u95f4\u9694\u65f6\u95f4\n        retries: 3               ##\u5065\u5eb7\u68c0\u67e5\u7684\u91cd\u8bd5\u6b21\u6570\n      logs:\n      - logs/*.log               ##\u914d\u7f6e\u670d\u52a1\u7684\u65e5\u5fd7\u5730\u5740\n      prometheus_port: 9515      ##\u914d\u7f6e\u670d\u52a1\u542f\u52a8\u7684export\u7684\u76d1\u542c\u7aef\u53e3\n    group: test          ##\u670d\u52a1\u7684\u5206\u7ec4\uff0c\u8ddf\u9875\u9762\u7684\u670d\u52a1\u5c55\u793a\u6709\u5173\u7cfb\n    config:       ##\u914d\u7f6e\u6620\u5c04,\u914d\u7f6e\u6587\u4ef6\u9700\u8981\u5728config_paths\u4e2d\u5b9a\u4e49\n      java_opts: "-Xms2048m -Xmx2048m"\n      service_port: 8090\n')),(0,r.kt)("h2",{id:"mero\u6253\u5305"},"mero\u6253\u5305"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u6253\u5305\u51c6\u5907")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@rel43-em mero]# ls -l\ntotal 4\ndrwxr-xr-x 5 root root   40 May 30 00:09 Back\n-rw-r--r-- 1 root root 1097 May 30 00:08 schema.yml\n[root@rel43-em mero]# ls -R\n.:\nBack  schema.yml\n\n./Back:\nbin  conf  lib\n\n./Back/bin:\nbase.sh  health.sh  post_deploy.sh\n\n./Back/conf:\napplication.properties\n\n./Back/lib:\ntest.jar\n[root@rel43-em mero]# \n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u6267\u884cmero")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bas"},'[root@rel43-em mero]# ls -l\ntotal 4\ndrwxr-xr-x 5 root root   40 May 30 00:09 Back\n-rw-r--r-- 1 root root 1097 May 30 00:08 schema.yml\n[root@rel43-em mero]# mero .\nProduct package create success: "Test_pkg_v1.0.1.tar"\n[root@rel43-em mero]# ls -l\ntotal 12\ndrwxr-xr-x 5 root root   40 May 30 00:09 Back\n-rw-r--r-- 1 root root 1097 May 30 00:08 schema.yml\n-rw-r--r-- 1 root root 5120 May 30 00:26 Test_pkg_v1.0.1.tar\n[root@rel43-em mero]# \n')),(0,r.kt)("p",null,"\u81f3\u6b64\uff0c\u4e00\u4e2a\u4ea7\u54c1\u5305\u5236\u4f5c\u5b8c\u6210"))}u.isMDXComponent=!0}}]);